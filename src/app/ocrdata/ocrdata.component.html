<!-- <div class="container mt-2">
    <div class="row">
        <div>
            <p><b>Clinical Diagnosis:</b></p>
            <p *ngFor="let res of data.Clinical_Diagnosis;index as i">
                {{i+1}}.{{res.clinical_diagnosis_name}}
            </p>
        </div>
    </div>
</div>

<div class="container mt-2">
    <div class="row">
        <div>
            <p><b>Investigations:</b></p>
            <p *ngFor="let res of data.Investigations;index as i">
                {{i+1}}. {{res.investigation_name}}
            </p>
        </div>
    </div>
</div>


<div class="container mt-2">
    <div class="row">
        <div>
            <p><b>Drugs:</b></p>
            <table class="table">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Drug Name</th>
                    <th scope="col">Dose</th>
                    <th scope="col">Food</th>
                    <th scope="col">Days</th>
                    <th scope="col">Remarks</th>
                  </tr>
                </thead>
                <tbody *ngFor="let res of data.Drugs;index as i">
                  <tr *ngIf="res.drug_name != '-'">
                    <th scope="row">{{i+1}}.</th>
                    <td>{{res.drug_name}}</td>
                    <td>{{res.dosage}}</td>
                    <td>{{res.food}}</td>
                    <td>{{res.duration}}</td>
                    <td>{{res.remarks}}</td>
                  </tr>
                </tbody>
              </table>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <mat-checkbox class="example-margin">I Authentic the above information is true.</mat-checkbox>
    </div>
</div> -->

<!-- <div class="container"> -->
    <div class="row px-3">
      <div class="col-12 mt-2">
        <button mat-raised-button (click)="editAll()" color="primary">{{ editformbtnText }}</button>
      </div>
    </div>
    <div class="row mt-3 p-4">
        <div class="col-12 col-md-6">
            <p><b>Investigations:</b></p>

              <div class="row" *ngFor="let data of inv ;let i= index">
                <!-- <div class="row" *ngFor="let field of invDForm.get('invField').controls;let id = index" [formGroupName]="id"> -->
                  <div class="col-11">
                    <mat-form-field>
                      <input type="text"  #query (input)="updateInv(i, query.value)"  [disabled]="showText" [(ngModel)]="data.investigation_name" (ngModelChange)="invsearch(query.value)"
                            aria-label="Number"
                            matInput
                            [matAutocomplete]="auto1" required>
                            <mat-hint>Please enter Minimum 3 letters</mat-hint>
                            <!-- <input type="hidden" formControlName ="Inv_id" class="form-control" [(ngModel)]="Inv_id"> -->
                        
                            <mat-autocomplete #auto1="matAutocomplete" >
                              <!-- <mat-option *ngIf="isLoading" class="is-loading"><mat-spinner diameter="50"></mat-spinner></mat-option> -->
                              <!-- ,'myforminv' -->
                              <mat-option *ngFor="let option of options" [value]="option.investigation" (click)="getinvid(option.investigation_id);insearch(InForm.value)">
                                {{option.investigation}}
                              </mat-option>
                            </mat-autocomplete>
                            
      
                      <mat-error *ngIf="isadded && InForm.get('queryinvField').hasError('required')">
                        Please Select Investigations name 
                      </mat-error>
                    </mat-form-field>
                    <!-- <div class="form-group">
                      <input type="text" [disabled]="showText" value="{{data.investigation_name}}" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
                    </div> -->
                  </div>
                  <div class="col-1">
                    <button mat-mini-fab [disabled]="btnDisabled" (click)="removeInv(i)" color="warn"><mat-icon>remove</mat-icon></button>
                  </div>
              </div>
                  <!-- <div class="col-2"> -->
                  <!-- <mat-icon (click)="edit(i,data.investigation_name)">edit</mat-icon> -->
                  </div>
              
              <!-- <div *ngFor="let data of inv;let i= index">
                
                <p>{{data.investigation_name}}<span><mat-icon (click)="edit(i,data.investigation_name);">edit</mat-icon></span></p>
              </div> -->
            <!-- </div> -->
            <!-- <table mat-table [dataSource]="inv" class="mat-elevation-z8">
  
                <ng-container matColumnDef="position">
                  <th mat-header-cell *matHeaderCellDef> No. </th>
                  <td mat-cell *matCellDef="let element ;let i= index"> {{i+1}} </td>
                </ng-container>

                <ng-container matColumnDef="clinical_diagnosis">
                  <th mat-header-cell *matHeaderCellDef> Name </th>
                  <td mat-cell *matCellDef="let element"> 
                    <form class="example-form">
                        <mat-form-field class="example-full-width" appearance="outline">
                          <input type="text" (change)="valuechange($event)" 
                                 placeholder="Pick one"
                                 aria-label="Number"
                                 matInput
                                 [formControl]
                                 value="{{element.investigation_name}}"
                                 [matAutocomplete]="auto">
                          <mat-autocomplete #auto="matAutocomplete">
                            <mat-option *ngFor="let option of filteredOptionss | async" [value]="option">
                              {{option}}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                      </form>
                 </td>
                </ng-container>
              
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table> -->
        <!-- <div class="col-12 col-md-6">
          <p><b>Clinical Diagnosis:</b></p>
          <div class="cd_header" *ngIf="showcdEdit">
             <form [formGroup]='CdForm' #myformcd="ngForm" (ngSubmit)="cdsearch(CdForm.value,myformcd)"> 
              <div class="row ">
                  <div class="col-8 col-md-8 " data-step="1" data-intro="Add clinical diagnosis from search to patients" data-position='right'>
                          <mat-form-field>
                            <input type="text"  #term (ngModelChange)="search(term.value)"
                                  placeholder="Search Diagnosis here.."
                                  aria-label="Number"
                                  matInput
                                  id="keyword"
                                  formControlName='queryField'
                                  [matAutocomplete]="auto"  required>
                                  <input type="hidden" formControlName ="cd_id" class="form-control" [(ngModel)]="cd_id">
                                  <input type="hidden" formControlName ="cd_code" class="form-control" [(ngModel)]="cd_code"> -->
                                  <!-- <mat-hint>Please enter Minimum 3 letters</mat-hint> -->
                                  <!-- <button mat-raised-button matSuffix type="submit"  class="sufix mt-1 custom_css_btn my_bg_v" ><mat-icon>add</mat-icon></button>  -->

                                  <!-- <mat-icon class="sufix" (click)="cdsearch(CdForm.value,myformcd)" matSuffix>search</mat-icon> -->
                            <!-- <mat-autocomplete #auto="matAutocomplete"  >
                              <mat-option *ngIf="isLoading" class="is-loading"><mat-spinner diameter="50"></mat-spinner></mat-option>
                                <mat-option *ngFor="let item of items | async " [value]="item.disease_name" (click)="getId(item.clinical_diagnosis_id,item.code);cdsearch(CdForm.value,myformcd)" >
                                  <span>{{item.disease_name}} ({{item.code}})</span>
                                 </mat-option>
                            </mat-autocomplete>
                            <mat-error *ngIf="isSubmitted && CdForm.get('queryField').hasError('required')">
                              Please Select diagnosis name 
                            </mat-error>
                          </mat-form-field>
                        
                  </div>
                  <div class="col-4  col-md-4 p-0 d-flex" >
                    <div class="">
                      <button  mat-raised-button type="submit"   class="mt-1 custom_css_btn my_bg_v">Edit</button> 

                    </div>
                    <div class="" data-step="2" data-intro="Click on pencil icon for handwriting" data-position='right'>
                      <button mat-flat-button  type="button"  class=" ml-2 mt-1 custom_css_btn__sketch  my_bg_v " (click)="openDialog()" style="height: 36px; min-width: 0px;" > <i class="fa fa-pencil fa-1x" aria-hidden="true"  ></i> </button> 

                    </div>

                  </div>
                  
              </div>
             </form>
          </div> --> 
             <div class="col-12 col-md-6">
              <p><b>Clinical Diagnosis:</b></p>
              <div class="row" *ngFor="let data of cd;let i= index">
                <div class="col-11">
                 <mat-form-field>
                   <input type="text" [disabled]="showText"   #term (input)="updateCd(i, term.value)" (ngModelChange)="search(term.value)" [(ngModel)]="data.clinical_diagnosis_name"
                         placeholder="Search Diagnosis here.."
                         aria-label="Number"
                         matInput
                         id="keyword"
                         [matAutocomplete]="auto"  required>
                         <!-- <input type="hidden" formControlName ="cd_id" class="form-control" [(ngModel)]="cd_id">
                         <input type="hidden" formControlName ="cd_code" class="form-control" [(ngModel)]="cd_code"> -->
                         <!-- <mat-hint>Please enter Minimum 3 letters</mat-hint> -->
                         <!-- <button mat-raised-button matSuffix type="submit"  class="sufix mt-1 custom_css_btn my_bg_v" ><mat-icon>add</mat-icon></button>  -->
 
                         <!-- <mat-icon class="sufix" (click)="cdsearch(CdForm.value,myformcd)" matSuffix>search</mat-icon> -->
                   <mat-autocomplete #auto="matAutocomplete"  >
                     <mat-option *ngIf="isLoading" class="is-loading"><mat-spinner diameter="50"></mat-spinner></mat-option>
                     <!-- ,'myformcd' -->
                       <mat-option *ngFor="let item of items | async " [value]="item.disease_name" (click)="getId(item.clinical_diagnosis_id,item.code);cdsearch(CdForm.value)" >
                         <span>{{item.disease_name}} ({{item.code}})</span>
                        </mat-option>
                   </mat-autocomplete>
                   <mat-error *ngIf="isSubmitted && CdForm.get('queryField').hasError('required')">
                     Please Select diagnosis name 
                   </mat-error>
                 </mat-form-field>
                </div>
                <div class="col-1">
                  <button mat-mini-fab [disabled]="btnDisabled" (click)="removeCd(i)" color="warn"><mat-icon>remove</mat-icon></button>
                </div>
               <!-- <div class="col-10">
                <div>
                  <div class="form-group">
                    <input type="text" [disabled]="showText" value="{{data.clinical_diagnosis_name}}" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
                  </div>
                </div>
               </div>
               <div class="col-2">
                <mat-icon (click)="editCD(i,data.clinical_diagnosis_name)">edit</mat-icon>
               </div> -->
             </div>
         </div>
             </div>
    <!-- </div> -->

    <div class="col-12 d-none d-md-block">
      <p><b>Drugs:</b></p>
      <div *ngIf="hideDrugs">
        <form [formGroup]='DrugForm' #myformDrug="ngForm" (ngSubmit)="Prescribe(DrugForm.value,myformDrug)">
          <div class="row">
            <div class="col-12">
              <table class="table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th scope="col">Drug Name</th>
                    <th scope="col">Dose</th>
                    <th scope="col">Food</th>
                    <th scope="col">Days</th>
                    <th scope="col">Frequency</th>
                    <th scope="col">Remarks</th>
                    <th scope="col">Edit</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1</td>
                    <td>
                      <div class="search" style="width:70%">
                            <mat-form-field appearance="outline">
                              <input type="text" id="drug" #drugs (ngModelChange)="drugsearch(drugs.value)"
                                    placeholder="Type Medicine here..."
                                    aria-label="Number"
                                    matInput
                                    id="keyword"
                                    formControlName='drugField'
                                    [matAutocomplete]="auto2" required>
                                
                              <mat-autocomplete #auto2="matAutocomplete">
                                <!-- <mat-option *ngIf="isLoading" class="is-loading"><mat-spinner diameter="50"></mat-spinner></mat-option> -->
                                
                                <mat-option class="p-1" *ngFor="let item of results " [value]="item.trade_name" (click)="druginfo(item)" >
                                <div class="d-inline-flex w-100 fs" [ngStyle]="(item.available_quantity > '0' || item.common == '1')?{'background-color':'white','color':'black','font-weight':'bold'}:{'background-color':'white','color':'#6e8178','font-weight':'lighter'}">
                                  <div>{{item.trade_name}} </div>
                                <div class="ml-2">
                                  <span class="qty" *ngIf="item.available_quantity !=''">Qty:{{item.available_quantity}}</span>
                                </div>
                                <!-- <label class="ml-2 badge badge-success"></label> -->
                                <label class="ml-2 expdate" *ngIf="item.available_quantity > '0'">{{item.expiry_date | date: 'dd-MM-yyyy'}}</label>
                                </div>
                                
                                </mat-option>
                              </mat-autocomplete>
                              <mat-error *ngIf="isprescribed && DrugForm.get('drugField').hasError('required')">
                                Please Enter Medicine name
                              </mat-error>
                            </mat-form-field>
                          
                      </div>
                    </td>
                    <td>{{drugData.dose}}</td>
                    <td>{{drugData.food}}</td>
                    <td>Mark</td>
                    <td>Mark</td>
                    <td>Mark</td>
                    <td>Mark</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </form>
      </div>
     
      <table class="table table-hover">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Drug Name</th>
              <th scope="col">Dose</th>
              <th scope="col">Food</th>
              <th scope="col">Days</th>
              <th scope="col">Frequency</th>
              <th scope="col">Remarks</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody *ngFor="let res of drugs;index as i">
            <tr *ngIf="res.drug_name != '-'">
              <th scope="row">{{i+1}}.</th>
              <td>
                <mat-form-field appearance="outline">
                  <input type="text" [disabled]="showText" id="drug" #drugName (input)="updateDrugName(i, drugName.value)" [(ngModel)]="res.drug_name" #drugs (ngModelChange)="drugsearch(drugs.value)"
                        placeholder="Type Medicine here..."
                        aria-label="Number"
                        matInput
                        id="keyword"
                        [matAutocomplete]="auto2" required>
                    
                  <mat-autocomplete #auto2="matAutocomplete">
                    <!-- <mat-option *ngIf="isLoading" class="is-loading"><mat-spinner diameter="50"></mat-spinner></mat-option> -->
                    
                    <mat-option class="p-1" *ngFor="let item of results " [value]="item.trade_name" (click)="druginfo(item)" >
                    <div class="d-inline-flex w-100 fs" [ngStyle]="(item.available_quantity > '0' || item.common == '1')?{'background-color':'white','color':'black','font-weight':'bold'}:{'background-color':'white','color':'#6e8178','font-weight':'lighter'}">
                      <div>{{item.trade_name}} </div>
                    <div class="ml-2">
                      <span class="qty" *ngIf="item.available_quantity !=''">Qty:{{item.available_quantity}}</span>
                    </div>
                    <!-- <label class="ml-2 badge badge-success"></label> -->
                    <label class="ml-2 expdate" *ngIf="item.available_quantity > '0'">{{item.expiry_date | date: 'dd-MM-yyyy'}}</label>
                    </div>
                    
                    </mat-option>
                  </mat-autocomplete>
                  <mat-error *ngIf="isprescribed && DrugForm.get('drugField').hasError('required')">
                    Please Enter Medicine name
                  </mat-error>
                </mat-form-field>
                <!-- <div>
                  <div class="form-group">
                    <input type="text" [disabled]="showText" value="{{res.drug_name}}" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
                  </div>
                </div> -->
                  <!-- <input class="form-control" type="text"  value="{{res.drug_name}}"> -->
                  <!-- {{res.drug_name}} -->
              </td>
              <td> 
                  <input class="form-control" #dose (input)="updateDose(i, dose.value)" [disabled]="showText" type="text" value="{{res.dose}}">
                  <!-- {{res.dosage}} -->
              </td>
              <td>
                  <input class="form-control" #food (input)="updateFood(i, food.value)" [disabled]="showText"  type="text"  value="{{res.food}}">
                  <!-- {{res.food}} -->
              </td>
              <td>
                  <input class="form-control" #duration (input)="updateDays(i, duration.value)" [disabled]="showText"  type="text"  value="{{res.duration}}">
                  <!-- {{res.duration}} -->
              </td>
              <td>
                <input class="form-control" #frequency (input)="updateFrequency(i, frequency.value)" [disabled]="showText"  type="text"  value="{{res.frequency}}">
                <!-- {{res.remarks}} -->
              </td>
              <td>
                  <input class="form-control" #remarks (input)="updateRemarks(i, remarks.value)" [disabled]="showText"  type="text"  value="{{res.remarks}}">
                  <!-- {{res.remarks}} -->
              </td>
              <td>
                  <button mat-mini-fab [disabled]="btnDisabled" (click)="removeDrug(i)" color="warn"><mat-icon>remove</mat-icon></button>
              </td>
              <!-- <td>
                <mat-icon class="open"  data-toggle="modal" data-target="#myModal" (click)="editDrugss(i,res.drug_name)">edit</mat-icon>
                <mat-icon (click)="editDrugs(i,res.drug_name)">edit</mat-icon>
            </td> -->
            </tr>
          </tbody>
      </table>
    </div>

    <div class="col-12 d-block d-md-none">
      <p><b>Drugs:</b></p>
      <div *ngFor="let res of data.Drugs;index as i" style="margin-bottom: 7px;">
        <div class="card" style="width: 18rem;" *ngIf="res.drug_name != '-'">
          <div class="card-header">
           <span style="font-weight: bold;">{{i+1}}.{{res.drug_name}}</span><span style="float:right;"><mat-icon (click)="editDrugs(i,res.drug_name)">edit</mat-icon></span>
          </div>
          <ul class="list-group list-group-flush">
            <!-- <li class="list-group-item">{{res.drug_name}}</li> -->
            <li class="list-group-item">{{res.dose}}</li>
            <li class="list-group-item">{{res.frequency}}</li>
            <li class="list-group-item">{{res.food}}</li>
            <li class="list-group-item">{{res.duration}}</li>
            <li class="list-group-item">{{res.remarks}}</li>
          </ul>
        </div>
      </div>
    </div>
    <div style="text-align: center;">
        <section class="example-section">
            <mat-checkbox color="primary" class="example-margin" (change)="toggle($event)">Please authenticate the above information.</mat-checkbox>
          </section>
        <button mat-stroked-button class="my_bg_v" (click)="finalSubmit()">Submit</button>
    </div>
<!-- The Modal -->
<div class="modal" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Edit Drugs</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <input type="text" name="bookId" id="bookId" value=""/>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Edit</button>
      </div>

    </div>
  </div>
</div>
